<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>expense tracker</title>
</head>
<body>
   <form id="container">
       <label>Choose ExpenseAmount: </label>
       <input type="number" id="number" name="amount" required>
       <label>Choose Description</label>
       <input type="text" id="detail" name="description" required>
       <label>Choose a Category</label>
       <select id="category" value>
           <option selected disabled hidden></option>
           <option >fuel</option>
           <option >food</option>
           <option >electricity</option>
           <option >movie</option>
       </select>
       <button>Submit</button>
   </form> 
   <ul id="item_list"></ul>
   <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
   <script>
        var user_id=undefined;
      //get data from server using network call
       try {
        window.addEventListener('DOMContentLoaded',async()=>{
               const res=await axios.get('https://crudcrud.com/api/56252ca32d164d81b8b049acbb701676/expense-data'); 
               console.log(res)
               for(let i=0;i<res.data.length;i++){
                    showResponse(res.data[i]);
                }
            })
        }

        catch (error) {
           console.log(error)
       }
       
     //save data at server using network call
   try {
    document.getElementById('container')
        .addEventListener('submit',addUser);

       async function addUser(event){
            event.preventDefault();
            let amount =event.target.amount.value;
            let description=event.target.description.value;
            let category=event.target.category.value;
            const obj={
                amount,
                description,
                category
            }
           console.log(obj)
            
                console.log('we are here')
                if(user_id===undefined){

                 const res=await axios.post('https://crudcrud.com/api/56252ca32d164d81b8b049acbb701676/expense-data',obj);
                  showResponse(res.data)
                    console.log('added');
                }else{
                 await axios.put(`https://crudcrud.com/api/56252ca32d164d81b8b049acbb701676/expense-data/${user_id}`,obj);
                    let userList=document.getElementById('item_list');
                    let list=document.createElement('li');
                    list.id=user_id;
                    list.innerHTML=`${amount} - ${category} - ${description} `;
                    let deleteBtn=document.createElement('button');
                    deleteBtn.appendChild(document.createTextNode('Delete expense'));
                    deleteBtn.className='deleted';
                    list.append(deleteBtn);

                    let editBtn=document.createElement('button');
                    editBtn.appendChild(document.createTextNode('Edit Expense'));
                    editBtn.className='edited';
                    list.appendChild(editBtn);
                    userList.appendChild(list);
                    
                    let user_List =document.getElementById('item_list');
                    let lists=document.getElementById(user_id);
                    if(lists){
                        user_List.removeChild(lists);
                    }
                    user_id=undefined;    
           }
            }
            
            document.getElementById('number').value='';
            document.getElementById('detail').value='';
            document.getElementById('category').value='';

        }
       
        catch (error) {
           console.log(error)
         }
        

        //Edit and delete user data
        try {
            document.getElementById('item_list')
        .addEventListener('click',deleteORedit)

        async function deleteORedit(event){
            if(event.target.classList.contains('deleted')){
               await axios.delete(`https://crudcrud.com/api/56252ca32d164d81b8b049acbb701676/expense-data/${event.target.parentElement.id}`)
                    console.log('deleted')
                    removeList(event.target.parentElement.id);
            }
            if(event.target.classList.contains('edited')){
                const res=await axios.get(`https://crudcrud.com/api/56252ca32d164d81b8b049acbb701676/expense-data/${event.target.parentElement.id}`)
                document.getElementById('number').value=res.data.amount;
                document.getElementById('detail').value=res.data.description;
                document.getElementById('category').value=res.data.category;
                user_id=res.data._id;
                console.log('edited');                
            }
        }
     } catch (error) {
            console.log(error)
        }


        function showResponse(data){
            let userList=document.getElementById('item_list');
            let list=document.createElement('li');
            list.id=data._id;
            list.innerHTML=`${data.amount} - ${data.category} - ${data.description} `;
            let deleteBtn=document.createElement('button');
            deleteBtn.appendChild(document.createTextNode('Delete Expense'));
            deleteBtn.className='deleted';
            list.append(deleteBtn);

            let editBtn=document.createElement('button');
            editBtn.appendChild(document.createTextNode('Edit Expense'));
            editBtn.className='edited';
            list.appendChild(editBtn);

            userList.appendChild(list);
        }
        
            function removeList(event){
                    let userList=document.getElementById('item_list');
                    let childDeleted=document.getElementById(event);
                    if(childDeleted){
                        userList.removeChild(childDeleted);
                    }
            }
        
   </script>
</body>
</html>